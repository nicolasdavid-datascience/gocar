<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Meta tags b√°sicas -->
    <meta charset="UTF-8" /> <!-- Define a codifica√ß√£o de caracteres como UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- Configura viewport para responsividade -->
    
    <!-- T√≠tulo da p√°gina -->
    <title>Controle Combust√≠vel Uber</title>
    
    <!-- Importa√ß√£o da biblioteca Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Estilos CSS -->
    <style>
        /* Vari√°veis CSS para cores e temas */
        :root {
            --bg: #f5f5f5; /* Cor de fundo padr√£o */
            --card-bg: #fff; /* Cor de fundo dos cards */
            --text: #333; /* Cor do texto principal */
            --input-border: #ccc; /* Cor da borda dos inputs */
            --dark-bg: #2e2e2e; /* Cor de fundo para modo escuro */
            --dark-card: #3a3a3a; /* Cor dos cards no modo escuro */
            --dark-text: #eee; /* Cor do texto no modo escuro */
            --dark-input-border: #555; /* Cor da borda dos inputs no modo escuro */
            --red: #dc3545; /* Cor vermelha para erros/destaques */
            --primary: #007bff; /* Cor prim√°ria (azul) */
            --success: #28a745; /* Cor de sucesso (verde) */
            --info: #17a2b8; /* Cor informativa (azul claro) */
            --info-darker: #118c9f; /* Vers√£o mais escura da cor info */
            --progress-bg: #e9ecef; /* Cor de fundo da barra de progresso */
            --grey: #6c757d; /* Cor cinza */
        }

        /* Estilos gerais do corpo da p√°gina */
        body {
            margin: 0; /* Remove margens padr√£o */
            padding: 20px; /* Adiciona padding interno */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Define fonte padr√£o */
            background-color: var(--bg); /* Usa vari√°vel para cor de fundo */
            color: var(--text); /* Usa vari√°vel para cor do texto */
            transition: background-color 0.3s, color 0.3s; /* Transi√ß√£o suave para tema escuro */
            display: flex; /* Ativa flexbox */
            justify-content: center; /* Centraliza conte√∫do horizontalmente */
        }

        /* Estilos para o modo escuro */
        body.dark {
            background-color: var(--dark-bg); /* Cor de fundo escura */
            color: var(--dark-text); /* Cor do texto clara */
        }

        /* Container principal */
        .container {
            max-width: 460px; /* Largura m√°xima */
            width: 100%; /* Ocupa 100% da largura dispon√≠vel */
        }

        /* Estilo do t√≠tulo principal */
        h1 {
            text-align: center; /* Centraliza o texto */
            margin-bottom: 12px; /* Espa√ßamento inferior */
        }

        /* Container dos bot√µes superiores */
        .top-buttons {
            display: flex; /* Layout flex√≠vel */
            gap: 12px; /* Espa√ßo entre elementos */
            margin-bottom: 18px; /* Espa√ßamento inferior */
        }

        /* Estilo dos bot√µes superiores */
        .top-buttons button {
            flex: 1; /* Distribui espa√ßo igualmente */
            padding: 10px 18px; /* Espa√ßamento interno */
            border: none; /* Remove borda */
            border-radius: 8px; /* Bordas arredondadas */
            font-weight: 600; /* Peso da fonte */
            cursor: pointer; /* Cursor de ponteiro */
            font-size: 16px; /* Tamanho da fonte */
            background-color: var(--primary); /* Cor de fundo */
            color: white; /* Cor do texto */
            transition: background-color 0.3s; /* Transi√ß√£o suave */
        }

        /* Estilo para bot√µes ativos ou com hover */
        .top-buttons button.active,
        .top-buttons button:hover {
            background-color: var(--success); /* Muda cor ao passar mouse */
        }

        /* Bot√£o de alternar tema escuro */
        .toggle-dark {
            position: absolute; /* Posicionamento absoluto */
            top: 20px; /* Dist√¢ncia do topo */
            right: 20px; /* Dist√¢ncia da direita */
            padding: 6px 12px; /* Espa√ßamento interno */
            border: none; /* Remove borda */
            background-color: var(--primary); /* Cor de fundo */
            color: white; /* Cor do texto */
            border-radius: 6px; /* Bordas arredondadas */
            cursor: pointer; /* Cursor de ponteiro */
            z-index: 10; /* Camada superior */
        }

        /* Estilo base para cards */
        .card {
            background-color: var(--card-bg); /* Cor de fundo */
            border-radius: 12px; /* Bordas arredondadas */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* Sombra sutil */
            padding: 20px; /* Espa√ßamento interno */
            margin-bottom: 15px; /* Espa√ßamento inferior */
            position: relative; /* Posicionamento relativo */
            transition: background-color 0.3s; /* Transi√ß√£o suave */
        }

        /* Estilo para cards agrupados por data */
        .date-group .card {
            border-top: 2px solid var(--info); /* Borda superior */
            border-radius: 0; /* Remove bordas arredondadas */
            margin-bottom: 0; /* Remove espa√ßamento */
            padding-top: 15px; /* Ajuste de espa√ßamento */
            padding-bottom: 15px; /* Ajuste de espa√ßamento */
        }

        /* Estilo para o primeiro card do grupo */
        .date-group .card:first-of-type {
            border-top-left-radius: 12px; /* Borda superior esquerda */
            border-top-right-radius: 12px; /* Borda superior direita */
        }

        /* Estilo para o √∫ltimo card do grupo */
        .date-group .card:last-of-type {
            border-bottom-left-radius: 12px; /* Borda inferior esquerda */
            border-bottom-right-radius: 12px; /* Borda inferior direita */
            margin-bottom: 20px; /* Espa√ßamento inferior */
        }

        /* Ajuste de cor para cards no modo escuro */
        body.dark .card {
            background-color: var(--dark-card); /* Cor de fundo escura */
        }

        /* Estilo para labels */
        label {
            display: block; /* Exibe como bloco */
            margin-bottom: 8px; /* Espa√ßamento inferior */
            font-weight: 600; /* Peso da fonte */
        }

        /* Estilo para inputs num√©ricos e de data */
        input[type='number'],
        input[type='date'] {
            width: 100%; /* Largura total */
            padding: 12px; /* Espa√ßamento interno */
            border-radius: 6px; /* Bordas arredondadas */
            border: 1px solid var(--input-border); /* Borda */
            margin-bottom: 16px; /* Espa√ßamento inferior */
            box-sizing: border-box; /* Modelo de caixa */
            transition: border-color 0.3s, background-color 0.3s, color 0.3s; /* Transi√ß√µes */
            font-size: 16px; /* Tamanho da fonte */
        }

        /* Ajustes para inputs no modo escuro */
        body.dark input {
            border-color: var(--dark-input-border); /* Cor da borda */
            background-color: var(--dark-card); /* Cor de fundo */
            color: var(--dark-text); /* Cor do texto */
        }

        /* Estilo para inputs inv√°lidos */
        input.invalid {
            border-color: var(--red) !important; /* Borda vermelha */
        }

        /* Estilo para bot√£o prim√°rio */
        button.btn-primary {
            background-color: var(--primary); /* Cor de fundo */
            color: white; /* Cor do texto */
            font-size: 16px; /* Tamanho da fonte */
            font-weight: 600; /* Peso da fonte */
            padding: 12px 20px; /* Espa√ßamento interno */
            border: none; /* Remove borda */
            border-radius: 8px; /* Bordas arredondadas */
            cursor: pointer; /* Cursor de ponteiro */
            transition: background-color 0.3s; /* Transi√ß√£o suave */
            margin-top: 8px; /* Espa√ßamento superior */
            width: 100%; /* Largura total */
        }

        /* Efeito hover para bot√£o prim√°rio */
        button.btn-primary:hover {
            background-color: #0056b3; /* Cor mais escura */
        }

        /* Estilo para √°rea de resultados */
        .result {
            padding-top: 0px; /* Espa√ßamento superior */
            font-size: 0.9em; /* Tamanho da fonte */
            line-height: 1.4; /* Altura da linha */
        }

        /* Blocos dentro dos resultados */
        .result .bloco {
            margin-bottom: 10px; /* Espa√ßamento inferior */
        }

        /* Linha divis√≥ria */
        .result hr {
            border: none; /* Remove borda padr√£o */
            border-top: 1px dashed var(--input-border); /* Linha tracejada */
            margin: 10px 0; /* Espa√ßamento vertical */
        }

        /* Labels dentro dos resultados */
        .result span.label {
            font-weight: 600; /* Peso da fonte */
            display: block; /* Exibe como bloco */
            margin-bottom: 0px; /* Remove espa√ßamento inferior */
            color: var(--text); /* Cor do texto */
        }

        /* Ajuste para labels no modo escuro */
        body.dark .result span.label {
            color: var(--dark-text); /* Cor do texto clara */
        }

        /* Destaque para texto dentro de labels */
        .result span.label strong {
            color: var(--primary); /* Cor azul */
        }

        /* Label especial para faturamento */
        .result .bloco .label.faturamento {
            font-size: 1em; /* Tamanho da fonte */
            color: var(--text); /* Cor do texto */
            font-weight: bold; /* Negrito */
        }

        /* Ajuste para label de faturamento no modo escuro */
        body.dark .result .bloco .label.faturamento {
            color: var(--dark-text); /* Cor do texto clara */
        }

        /* Opacidade para labels normais */
        .result .bloco span.label:not(.faturamento) {
            opacity: 0.90; /* Leve transpar√™ncia */
        }

        /* Ajuste para blocos com labels destacadas */
        .result .bloco:has(span.label strong) {
            margin-top: 2px; /* Pequeno espa√ßamento */
            margin-bottom: 0px; /* Remove espa√ßamento */
        }

        /* Ajuste para labels dentro de blocos destacados */
        .result .bloco:has(span.label strong) span.label {
            font-size: 0.85em; /* Tamanho menor */
            opacity: 0.75; /* Mais transparente */
            margin-bottom: 5px; /* Espa√ßamento inferior */
        }

        /* Ajuste para texto destacado */
        .result .bloco:has(span.label strong) span.label strong {
            font-size: 1em; /* Tamanho normal */
        }

        /* Borda de lucro na parte inferior */
        .lucro-borda {
            position: absolute; /* Posicionamento absoluto */
            bottom: 0; /* Alinhado na base */
            left: 0; /* Alinhado √† esquerda */
            width: 100%; /* Largura total */
            background-color: var(--success); /* Cor de fundo verde */
            color: white; /* Cor do texto */
            text-align: center; /* Texto centralizado */
            padding: 5px 0; /* Espa√ßamento vertical */
            border-bottom-left-radius: 12px; /* Borda inferior esquerda */
            border-bottom-right-radius: 12px; /* Borda inferior direita */
            font-weight: bold; /* Texto em negrito */
            font-size: 0.85em; /* Tamanho da fonte */
        }

        /* Cabe√ßalho de data */
        .data-header {
            background-color: var(--info-darker); /* Cor de fundo */
            color: white; /* Cor do texto */
            padding: 7px; /* Espa√ßamento interno */
            border-radius: 4px 4px 0px 0px; /* Bordas arredondadas apenas no topo */
            font-size: 1em; /* Tamanho da fonte */
            font-weight: bold; /* Texto em negrito */
            text-align: center; /* Texto centralizado */
            margin-bottom: 0px; /* Remove espa√ßamento */
            border: none; /* Remove borda */
        }

        /* Classe para esconder elementos */
        .hidden {
            display: none; /* Oculta o elemento */
        }

        /* Container de op√ß√µes do card */
        .card-options {
            position: absolute; /* Posicionamento absoluto */
            top: 10px; /* Dist√¢ncia do topo */
            right: 10px; /* Dist√¢ncia da direita */
            z-index: 100; /* Camada superior */
        }

        /* Bot√£o de op√ß√µes */
        .options-btn {
            background: none; /* Remove fundo */
            border: none; /* Remove borda */
            font-size: 20px; /* Tamanho da fonte */
            line-height: 1; /* Altura da linha */
            cursor: pointer; /* Cursor de ponteiro */
            padding: 5px; /* Espa√ßamento interno */
            color: var(--grey); /* Cor do √≠cone */
        }

        /* Ajuste para bot√£o de op√ß√µes no modo escuro */
        body.dark .options-btn {
            color: #aaa; /* Cor mais clara */
        }

        /* Menu de op√ß√µes */
        .options-menu {
            position: absolute; /* Posicionamento absoluto */
            top: 100%; /* Abaixo do bot√£o */
            right: 0; /* Alinhado √† direita */
            background-color: var(--card-bg); /* Cor de fundo */
            border: 1px solid var(--input-border); /* Borda */
            border-radius: 8px; /* Bordas arredondadas */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sombra */
            z-index: 100; /* Camada superior */
            overflow: hidden; /* Esconde conte√∫do extra */
            min-width: 120px; /* Largura m√≠nima */
        }

        /* Ajuste para menu no modo escuro */
        body.dark .options-menu {
            background-color: var(--dark-card); /* Cor de fundo escura */
            border-color: var(--dark-input-border); /* Cor da borda */
        }

        /* Itens do menu de op√ß√µes */
        .options-menu a {
            display: block; /* Exibe como bloco */
            padding: 8px 12px; /* Espa√ßamento interno */
            text-decoration: none; /* Remove sublinhado */
            color: var(--text); /* Cor do texto */
            cursor: pointer; /* Cursor de ponteiro */
            white-space: nowrap; /* Evita quebra de linha */
            font-size: 0.9em; /* Tamanho da fonte */
        }

        /* Ajuste para itens no modo escuro */
        body.dark .options-menu a {
            color: var(--dark-text); /* Cor do texto clara */
        }

        /* Efeito hover nos itens do menu */
        .options-menu a:hover {
            background-color: var(--bg); /* Cor de fundo ao passar mouse */
        }

        /* Ajuste para hover no modo escuro */
        body.dark .options-menu a:hover {
            background-color: #4f4f4f; /* Cor mais clara */
        }

        /* Item de exclus√£o no menu */
        .options-menu .delete-item {
            color: var(--red); /* Cor vermelha */
        }

        /* Estilo para modo de edi√ß√£o */
        .edit-view label {
            font-size: 0.85em; /* Tamanho menor */
            margin-bottom: 3px; /* Espa√ßamento reduzido */
        }

        /* Inputs no modo de edi√ß√£o */
        .edit-view input {
            padding: 7px; /* Espa√ßamento menor */
            margin-bottom: 8px; /* Espa√ßamento reduzido */
            font-size: 0.95em; /* Tamanho da fonte */
        }

        /* Container de a√ß√µes de edi√ß√£o */
        .edit-actions {
            display: flex; /* Layout flex√≠vel */
            gap: 8px; /* Espa√ßo entre bot√µes */
            margin-top: 8px; /* Espa√ßamento superior */
        }

        /* Bot√µes de a√ß√£o de edi√ß√£o */
        .edit-actions button {
            flex: 1; /* Distribui espa√ßo igualmente */
            padding: 7px; /* Espa√ßamento interno */
            font-size: 0.85em; /* Tamanho menor */
            font-weight: bold; /* Texto em negrito */
            border-radius: 6px; /* Bordas arredondadas */
            border: none; /* Remove borda */
            cursor: pointer; /* Cursor de ponteiro */
        }

        /* Bot√£o de salvar */
        .save-btn-card {
            background-color: var(--success); /* Cor verde */
            color: white; /* Texto branco */
        }

        /* Bot√£o de cancelar */
        .cancel-btn-card {
            background-color: var(--grey); /* Cor cinza */
            color: white; /* Texto branco */
        }

        /* Container do switch */
        .switch-container {
            display: flex; /* Layout flex√≠vel */
            align-items: center; /* Alinhamento vertical */
            margin-bottom: 16px; /* Espa√ßamento inferior */
            gap: 10px; /* Espa√ßo entre elementos */
        }

        /* Estilo do switch */
        .switch {
            position: relative; /* Posicionamento relativo */
            display: inline-block; /* Exibe em linha */
            width: 48px; /* Largura */
            height: 27.2px; /* Altura */
        }

        /* Input do switch (escondido) */
        .switch input {
            opacity: 0; /* Invis√≠vel */
            width: 0; /* Sem largura */
            height: 0; /* Sem altura */
        }

        /* Estilo do slider do switch */
        .slider {
            position: absolute; /* Posicionamento absoluto */
            cursor: pointer; /* Cursor de ponteiro */
            top: 0; /* Alinhado ao topo */
            left: 0; /* Alinhado √† esquerda */
            right: 0; /* Ocupa toda largura */
            bottom: 0; /* Ocupa toda altura */
            background-color: #ccc; /* Cor de fundo */
            transition: 0.4s; /* Transi√ß√£o suave */
            border-radius: 27.2px; /* Bordas arredondadas */
        }

        /* Bolinha do slider */
        .slider:before {
            position: absolute; /* Posicionamento absoluto */
            content: ""; /* Conte√∫do vazio */
            height: 20.4px; /* Altura */
            width: 20.4px; /* Largura */
            left: 3.4px; /* Posi√ß√£o √† esquerda */
            bottom: 3.4px; /* Posi√ß√£o inferior */
            background-color: white; /* Cor branca */
            transition: 0.4s; /* Transi√ß√£o suave */
            border-radius: 50%; /* Forma circular */
        }

        /* Estilo quando o switch est√° ativo */
        input:checked + .slider {
            background-color: var(--primary); /* Cor azul */
        }

        /* Efeito de foco */
        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary); /* Sombra sutil */
        }

        /* Movimento da bolinha quando ativo */
        input:checked + .slider:before {
            transform: translateX(20.4px); /* Desliza para direita */
        }

        /* Grupo de campos de faturamento/KM (inicialmente recolhido) */
        .faturamento-km-group {
            overflow: hidden; /* Esconde conte√∫do extra */
            max-height: 0; /* Altura zero */
            transition: max-height 0.3s ease-out; /* Anima√ß√£o de recolhimento */
        }

        /* Classe para mostrar o grupo */
        .faturamento-km-group.show {
            max-height: 200px; /* Altura m√°xima */
            transition: max-height 0.3s ease-in; /* Anima√ß√£o de expans√£o */
        }

        /* Card de sum√°rio */
        .summary-card {
            background-color: var(--card-bg); /* Cor de fundo */
            border-radius: 12px; /* Bordas arredondadas */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* Sombra sutil */
            padding: 20px; /* Espa√ßamento interno */
            margin-bottom: 20px; /* Espa√ßamento inferior */
            text-align: center; /* Texto centralizado */
            transition: background-color 0.3s; /* Transi√ß√£o suave */
            border: 1px solid var(--info); /* Borda colorida */
        }

        /* Ajuste para card no modo escuro */
        body.dark .summary-card {
            background-color: var(--dark-card); /* Cor de fundo escura */
        }

        /* T√≠tulo do sum√°rio */
        .summary-card h2 {
            margin-top: 0; /* Remove margem superior */
            color: var(--info); /* Cor do texto */
            font-size: 1.4em; /* Tamanho da fonte */
            margin-bottom: 15px; /* Espa√ßamento inferior */
        }

        /* Itens do sum√°rio */
        .summary-item {
            display: flex; /* Layout flex√≠vel */
            justify-content: space-between; /* Espa√ßo entre elementos */
            align-items: center; /* Alinhamento vertical */
            padding: 8px 0; /* Espa√ßamento vertical */
            border-bottom: 1px dashed var(--input-border); /* Linha divis√≥ria */
            font-size: 1.1em; /* Tamanho da fonte */
            font-weight: 500; /* Peso da fonte */
        }

        /* Remove borda do √∫ltimo item */
        .summary-item:last-of-type {
            border-bottom: none; /* Sem borda */
        }

        /* Primeiro span dentro do item (label) */
        .summary-item span:first-child {
            font-weight: 600; /* Texto em negrito */
            display: flex; /* Layout flex√≠vel */
            align-items: center; /* Alinhamento vertical */
            gap: 8px; /* Espa√ßo entre √≠cone e texto */
        }

        /* Segundo span dentro do item (valor) */
        .summary-item span:last-child {
            font-weight: bold; /* Texto em negrito */
            color: var(--text); /* Cor do texto */
        }

        /* Ajuste para valor no modo escuro */
        body.dark .summary-item span:last-child {
            color: var(--dark-text); /* Cor do texto clara */
        }

        /* Item de lucro */
        .summary-item.lucro span:last-child {
            color: var(--success); /* Cor verde */
        }

        /* Item de gastos */
        .summary-item.gastos span:last-child {
            color: var(--red); /* Cor vermelha */
        }

        /* Container da barra de progresso de lucro */
        .lucro-progress-container {
            margin-top: 20px; /* Espa√ßamento superior */
            text-align: left; /* Alinhamento √† esquerda */
        }

        /* Texto acima da barra de progresso */
        .lucro-progress-container p {
            margin-bottom: 8px; /* Espa√ßamento inferior */
            font-weight: 600; /* Texto em negrito */
            display: flex; /* Layout flex√≠vel */
            align-items: center; /* Alinhamento vertical */
            gap: 8px; /* Espa√ßo entre √≠cone e texto */
        }

        /* Container da barra de progresso */
        .lucro-progress-bar-container {
            width: 100%; /* Largura total */
            background-color: var(--progress-bg); /* Cor de fundo */
            border-radius: 10px; /* Bordas arredondadas */
            height: 20px; /* Altura fixa */
            overflow: hidden; /* Esconde conte√∫do extra */
        }

        /* Ajuste para container no modo escuro */
        body.dark .lucro-progress-bar-container {
            background-color: #555; /* Cor de fundo mais escura */
        }

        /* Barra de progresso */
        .lucro-progress-bar {
            height: 100%; /* Altura total */
            background-color: var(--success); /* Cor verde */
            width: 0%; /* Inicia em zero */
            border-radius: 10px; /* Bordas arredondadas */
            transition: width 0.5s ease-out; /* Anima√ß√£o suave */
            display: flex; /* Layout flex√≠vel */
            align-items: center; /* Centraliza verticalmente */
            justify-content: flex-end; /* Alinha texto √† direita */
            padding-right: 8px; /* Espa√ßamento interno */
            box-sizing: border-box; /* Modelo de caixa */
            color: white; /* Texto branco */
            font-weight: bold; /* Negrito */
            font-size: 0.9em; /* Tamanho da fonte */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3); /* Sombra no texto */
        }

        /* Barra quando passa de 100% */
        .lucro-progress-bar.over-100 {
            background-color: #00C851; /* Verde mais vibrante */
        }

        /* Bot√£o de reset */
        .reset-button {
            background-color: var(--red); /* Cor vermelha */
            color: white; /* Texto branco */
            font-size: 14px; /* Tamanho da fonte */
            padding: 8px 12px; /* Espa√ßamento interno */
            border: none; /* Remove borda */
            border-radius: 6px; /* Bordas arredondadas */
            cursor: pointer; /* Cursor de ponteiro */
            margin-top: 20px; /* Espa√ßamento superior */
            margin-bottom: 20px; /* Espa√ßamento inferior */
            width: 100%; /* Largura total */
            box-sizing: border-box; /* Modelo de caixa */
            transition: background-color 0.3s; /* Transi√ß√£o suave */
        }

        /* Efeito hover no bot√£o de reset */
        .reset-button:hover {
            background-color: #c82333; /* Vermelho mais escuro */
        }

        /* Container do tipo de combust√≠vel */
        .fuel-type-container {
            display: flex; /* Layout flex√≠vel */
            align-items: center; /* Alinhamento vertical */
            margin-bottom: 16px; /* Espa√ßamento inferior */
            background-color: var(--card-bg); /* Cor de fundo */
            border-radius: 8px; /* Bordas arredondadas */
            padding: 8px; /* Espa√ßamento interno */
            border: 1px solid var(--input-border); /* Borda */
        }
        
        /* Ajuste para container no modo escuro */
        body.dark .fuel-type-container {
            background-color: var(--dark-card); /* Cor de fundo escura */
            border-color: var(--dark-input-border); /* Cor da borda */
        }
        
        /* Label do tipo de combust√≠vel */
        .fuel-type-label {
            margin-right: 10px; /* Espa√ßamento √† direita */
            font-weight: 600; /* Texto em negrito */
            color: var(--text); /* Cor do texto */
        }
        
        /* Ajuste para label no modo escuro */
        body.dark .fuel-type-label {
            color: var(--dark-text); /* Cor do texto clara */
        }
        
        /* Toggle de combust√≠vel */
        .fuel-toggle {
            display: flex; /* Layout flex√≠vel */
            background-color: var(--progress-bg); /* Cor de fundo */
            border-radius: 20px; /* Bordas arredondadas */
            padding: 4px; /* Espa√ßamento interno */
            position: relative; /* Posicionamento relativo */
            cursor: pointer; /* Cursor de ponteiro */
        }
        
        /* Ajuste para toggle no modo escuro */
        body.dark .fuel-toggle {
            background-color: #555; /* Cor de fundo mais escura */
        }
        
        /* Op√ß√µes do toggle */
        .fuel-option {
            padding: 6px 12px; /* Espa√ßamento interno */
            z-index: 1; /* Camada superior */
            transition: color 0.3s; /* Transi√ß√£o suave */
            font-weight: 500; /* Peso da fonte */
        }
        
        /* Op√ß√£o ativa */
        .fuel-option.active {
            color: white; /* Texto branco */
        }
        
        /* Slider do toggle */
        .fuel-slider {
            position: absolute; /* Posicionamento absoluto */
            top: 4px; /* Dist√¢ncia do topo */
            bottom: 4px; /* Dist√¢ncia da base */
            width: calc(50% - 4px); /* Largura calculada */
            background-color: var(--success); /* Cor verde */
            border-radius: 16px; /* Bordas arredondadas */
            transition: transform 0.3s; /* Anima√ß√£o suave */
        }
        
        /* Posi√ß√£o do slider para gasolina */
        .fuel-slider.gasolina {
            transform: translateX(calc(100% + 4px)); /* Move para direita */
            background-color: var(--info); /* Cor azul */
        }
        
        /* Posi√ß√£o do slider para etanol */
        .fuel-slider.etanol {
            transform: translateX(0); /* Posi√ß√£o inicial */
        }

        /* Media queries para dispositivos m√≥veis */
        @media (max-width: 480px) {
            /* Ajustes gerais */
            body {
                padding: 10px; /* Espa√ßamento menor */
            }

            /* Bot√£o de tema escuro */
            .toggle-dark {
                top: 10px; /* Posi√ß√£o ajustada */
                right: 10px; /* Posi√ß√£o ajustada */
                padding: 4px 8px; /* Espa√ßamento menor */
            }

            /* Cards */
            .card {
                padding: 14px; /* Espa√ßamento menor */
            }

            /* Grupos de data */
            .date-group .card {
                margin-bottom: 0; /* Remove espa√ßamento */
            }

            /* √öltimo card do grupo */
            .date-group .card:last-of-type {
                margin-bottom: 15px; /* Espa√ßamento menor */
            }

            /* Bot√µes superiores */
            .top-buttons button {
                font-size: 14px; /* Tamanho menor */
                padding: 8px 12px; /* Espa√ßamento menor */
            }

            /* Inputs */
            input[type='number'],
            input[type='date'] {
                font-size: 14px; /* Tamanho menor */
                padding: 10px; /* Espa√ßamento menor */
            }

            /* Bot√£o prim√°rio */
            button.btn-primary {
                font-size: 14px; /* Tamanho menor */
                padding: 10px 16px; /* Espa√ßamento menor */
            }

            /* Switch */
            .switch {
                width: 40px; /* Largura menor */
                height: 22.4px; /* Altura menor */
            }

            /* Slider do switch */
            .slider {
                border-radius: 22.4px; /* Bordas arredondadas */
            }

            /* Bolinha do slider */
            .slider:before {
                height: 16.8px; /* Tamanho menor */
                width: 16.8px; /* Tamanho menor */
                left: 2.8px; /* Posi√ß√£o ajustada */
                bottom: 2.8px; /* Posi√ß√£o ajustada */
            }

            /* Posi√ß√£o da bolinha quando ativo */
            input:checked + .slider:before {
                transform: translateX(16.8px); /* Movimento menor */
            }

            /* Card de sum√°rio */
            .summary-card {
                padding: 15px; /* Espa√ßamento menor */
            }

            /* T√≠tulo do sum√°rio */
            .summary-card h2 {
                font-size: 1.2em; /* Tamanho menor */
            }

            /* Itens do sum√°rio */
            .summary-item {
                padding: 6px 0; /* Espa√ßamento menor */
                font-size: 0.9em; /* Tamanho menor */
            }
            
            /* Op√ß√µes de combust√≠vel */
            .fuel-option {
                padding: 6px 10px; /* Espa√ßamento menor */
                font-size: 0.9em; /* Tamanho menor */
            }
        }
    </style>
</head>

<body>
    <!-- Container principal -->
    <div class="container">
        <!-- T√≠tulo da aplica√ß√£o -->
        <h1>üìä Controle Combust√≠vel Uber</h1>
        
        <!-- Bot√µes de navega√ß√£o -->
        <div class="top-buttons">
            <button id="btnPainel" class="active">Painel</button>
            <button id="btnRelatorio">Relat√≥rio</button>
        </div>
        
        <!-- Bot√£o para alternar tema escuro -->
        <button class="toggle-dark">Modo Escuro</button>
        
        <!-- Se√ß√£o do painel (vis√≠vel por padr√£o) -->
        <div id="painel">
            <!-- Card do formul√°rio principal -->
            <div class="card">
                <!-- Campo de data -->
                <label for="data">Data</label>
                <input type="date" id="data" />
                
                <!-- Seletor de tipo de combust√≠vel -->
                <div class="fuel-type-container">
                    <span class="fuel-type-label">Combust√≠vel:</span>
                    <div class="fuel-toggle" id="fuelToggle">
                        <div class="fuel-slider etanol" id="fuelSlider"></div>
                        <div class="fuel-option active" data-value="etanol">Etanol</div>
                        <div class="fuel-option" data-value="gasolina">Gasolina</div>
                    </div>
                </div>
                
                <!-- Campos do formul√°rio -->
                <label for="valorLitro">Valor do Litro (R$)</label>
                <input type="number" id="valorLitro" step="0.01" />
                
                <label for="valorAbastecimento">Valor Abastecido (R$)</label>
                <input type="number" id="valorAbastecimento" step="0.01" />
                
                <!-- Switch para mostrar campos adicionais -->
                <div class="switch-container">
                    <label for="toggleFaturamentoKm">Inserir Faturamento + KM</label>
                    <label class="switch">
                        <input type="checkbox" id="toggleFaturamentoKm" />
                        <span class="slider"></span>
                    </label>
                </div>
                
                <!-- Campos condicionais (inicialmente ocultos) -->
                <div id="faturamentoKmGroup" class="faturamento-km-group">
                    <label for="faturamento">Faturamento do Dia (R$)</label>
                    <input type="number" id="faturamento" step="0.01" />
                    
                    <label for="kmRodado">KM Rodado no Dia</label>
                    <input type="number" id="kmRodado" step="0.1" />
                </div>
                
                <!-- Bot√£o para registrar os dados -->
                <button class="btn-primary">Registrar</button>
            </div>
            
            <!-- √Årea para exibir os resultados -->
            <div id="resultados"></div>
            
            <!-- Bot√£o para resetar todos os dados -->
            <button class="reset-button">Resetar Todos os Dados</button>
        </div>
        
        <!-- Se√ß√£o do relat√≥rio (inicialmente oculta) -->
        <div id="chart-container" class="card hidden">
            <!-- Card de sum√°rio -->
            <div class="summary-card">
                <h2>Sum√°rio Total üìà</h2>
                
                <!-- Itens do sum√°rio -->
                <div class="summary-item">
                    <span>üí∞ Faturamento:</span>
                    <span id="totalFaturamento">R$ 0,00</span>
                </div>
                
                <div class="summary-item gastos">
                    <span>‚õΩ Gastos com Combust√≠vel:</span>
                    <span id="totalGastosCombustivel">R$ 0,00</span>
                </div>
                
                <div class="summary-item lucro">
                    <span>üìä Lucro Bruto:</span>
                    <span id="totalLucro">R$ 0,00</span>
                </div>
                
                <div class="summary-item">
                    <span>üõ£Ô∏è M√©dia km/litro (Gasolina):</span>
                    <span id="mediaKmLitroGasolina">0,00 km/L</span>
                </div>
                
                <div class="summary-item">
                    <span>üõ£Ô∏è M√©dia km/litro (Etanol):</span>
                    <span id="mediaKmLitroEtanol">0,00 km/L</span>
                </div>
                
                <!-- Barra de progresso do lucro -->
                <div class="lucro-progress-container">
                    <p>üéØ Lucro Bruto (Faturamento/Combust√≠vel):</p>
                    <div class="lucro-progress-bar-container">
                        <div class="lucro-progress-bar" id="lucroProgressBar">
                            <span id="lucroProgressText">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Canvas para o gr√°fico -->
            <canvas id="grafico"></canvas>
        </div>
    </div>

    <!-- Script JavaScript -->
    <script>
        // Vari√°veis globais
        let registros = JSON.parse(localStorage.getItem('registros') || '{}'); // Carrega registros do localStorage ou inicia objeto vazio
        let chart; // Refer√™ncia para o gr√°fico
        const LUCRO_ALVO = 500; // Meta de lucro (n√£o utilizada atualmente)
        let fuelType = 'etanol'; // Tipo de combust√≠vel padr√£o

        // Fun√ß√£o para inicializar a aplica√ß√£o
        function initApp() {
            migrarEstruturaDados(); // Migra estrutura de dados antiga para nova se necess√°rio
            setDefaultDate(); // Define a data padr√£o como hoje
            setupEventListeners(); // Configura todos os event listeners
            
            // Restaura estado do toggle de faturamento/KM do localStorage
            const toggleFaturamentoKm = document.getElementById('toggleFaturamentoKm');
            toggleFaturamentoKm.checked = localStorage.getItem('faturamentoKmActive') === 'true';
            toggleFaturamentoKmFields(); // Aplica o estado do toggle
            
            // Configura o toggle de combust√≠vel
            const fuelOptions = document.querySelectorAll('.fuel-option');
            fuelOptions.forEach(option => {
                option.addEventListener('click', function() {
                    fuelType = this.dataset.value; // Atualiza o tipo de combust√≠vel
                    document.getElementById('fuelSlider').className = 'fuel-slider ' + fuelType; // Move o slider
                    fuelOptions.forEach(opt => opt.classList.remove('active')); // Remove classe ativa de todos
                    this.classList.add('active'); // Adiciona classe ativa ao selecionado
                });
            });
            
            renderizarResultados(); // Exibe os registros na tela
            criarGrafico(); // Inicializa o gr√°fico
            atualizarRelatorio(); // Atualiza o sum√°rio
            
            // Aplica modo escuro se estava ativo
            if (localStorage.getItem('dark') === 'true') {
                document.body.classList.add('dark');
            }
        }

        // Configura todos os event listeners da aplica√ß√£o
        function setupEventListeners() {
            // Bot√£o registrar - a√ß√£o principal
            document.querySelector('.btn-primary').addEventListener('click', handleMainAction);
            
            // Bot√£o resetar - limpa todos os dados
            document.querySelector('.reset-button').addEventListener('click', resetarDados);
            
            // Bot√£o modo escuro - alterna tema
            document.querySelector('.toggle-dark').addEventListener('click', toggleDark);
            
            // Bot√µes de navega√ß√£o entre painel e relat√≥rio
            document.getElementById('btnPainel').addEventListener('click', mostrarPainel);
            document.getElementById('btnRelatorio').addEventListener('click', mostrarRelatorio);
            
            // Toggle faturamento/KM - mostra/oculta campos adicionais
            document.getElementById('toggleFaturamentoKm').addEventListener('change', toggleFaturamentoKmFields);
            
            // Event delegation para os cards (permite adicionar eventos dinamicamente)
            document.getElementById('resultados').addEventListener('click', function(e) {
                const card = e.target.closest('.card');
                if (!card) return;
                
                const date = card.dataset.date;
                const id = card.dataset.id;
                
                // Bot√£o de op√ß√µes (‚ãÆ)
                if (e.target.matches('.options-btn')) {
                    e.stopPropagation();
                    const menu = card.querySelector('.options-menu');
                    // Esconde outros menus abertos
                    document.querySelectorAll('.options-menu').forEach(m => {
                        if (m !== menu) m.classList.add('hidden');
                    });
                    menu.classList.toggle('hidden'); // Alterna visibilidade do menu
                } 
                // Item de edi√ß√£o
                else if (e.target.matches('.edit-item')) {
                    ativarModoEdicao(id, date);
                } 
                // Item de exclus√£o
                else if (e.target.matches('.delete-item')) {
                    excluirRegistro(date, id);
                } 
                // Bot√£o de salvar edi√ß√£o
                else if (e.target.matches('.save-btn-card')) {
                    salvarEdicao(date, id);
                } 
                // Bot√£o de cancelar edi√ß√£o
                else if (e.target.matches('.cancel-btn-card')) {
                    desativarModoEdicao(id);
                } 
                // Bot√£o para adicionar faturamento/KM
                else if (e.target.matches('.add-faturamento-btn')) {
                    ativarModoEdicao(id, date, true);
                }
            });
        }

        // Migra estrutura de dados antiga para nova (compatibilidade)
        function migrarEstruturaDados() {
            let mudancaFeita = false;
            const tempRegistros = {};
            
            // Percorre todos os registros existentes
            Object.keys(registros).forEach(date => {
                if (Array.isArray(registros[date])) {
                    // Se j√° est√° no formato novo, mant√©m como est√°
                    tempRegistros[date] = registros[date];
                } else {
                    // Se est√° no formato antigo, converte para o novo
                    mudancaFeita = true;
                    const oldRecord = registros[date];
                    oldRecord.id = new Date(date).getTime(); // Adiciona ID baseado na data
                    oldRecord.fuelType = 'etanol'; // Define tipo de combust√≠vel padr√£o
                    tempRegistros[date] = [oldRecord]; // Cria array com o registro
                }
            });
            
            // Se houve mudan√ßas, salva a nova estrutura
            if (mudancaFeita) {
                registros = tempRegistros;
                localStorage.setItem('registros', JSON.stringify(registros));
            }
        }

        // Define a data padr√£o como a data atual
        function setDefaultDate() {
            const inputData = document.getElementById('data');
            if (!inputData.value) {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                inputData.value = `${year}-${month}-${day}`;
            }
        }

        // Alterna entre temas claro e escuro
        function toggleDark() {
            document.body.classList.toggle('dark'); // Alterna classe no body
            localStorage.setItem('dark', document.body.classList.contains('dark')); // Salva prefer√™ncia
        }

        // Mostra a se√ß√£o do painel e esconde o relat√≥rio
        function mostrarPainel() {
            document.getElementById('painel').classList.remove('hidden');
            document.getElementById('chart-container').classList.add('hidden');
            document.getElementById('btnPainel').classList.add('active');
            document.getElementById('btnRelatorio').classList.remove('active');
            renderizarResultados(); // Atualiza a exibi√ß√£o
            resetForm(); // Reseta o formul√°rio
        }

        // Mostra a se√ß√£o do relat√≥rio e esconde o painel
        function mostrarRelatorio() {
            document.getElementById('painel').classList.add('hidden');
            document.getElementById('chart-container').classList.remove('hidden');
            document.getElementById('btnRelatorio').classList.add('active');
            document.getElementById('btnPainel').classList.remove('active');
            atualizarGrafico(); // Atualiza o gr√°fico
            atualizarRelatorio(); // Atualiza o sum√°rio
        }

        // Formata a data para exibi√ß√£o (DD/MM/AAAA - Dia da semana)
        function formatarData(dataISO) {
            const diasSemana = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            const [ano, mes, dia] = dataISO.split('-');
            const dataObj = new Date(`${ano}-${mes}-${dia}T12:00:00`);
            const ds = diasSemana[dataObj.getDay()];
            return `${dia}/${mes}/${ano} - ${ds}`;
        }

        // Manipula a a√ß√£o principal (registrar novo abastecimento)
        function handleMainAction() {
            if (!validarFormularioPrincipal()) return; // Valida antes de prosseguir
            registrar(); // Registra os dados
        }

        // Registra um novo abastecimento
        function registrar() {
            const data = document.getElementById('data').value;
            const novoRegistro = calcularValoresDesdeFormulario('main'); // Calcula valores
            if (!novoRegistro) return; // Se valida√ß√£o falhou, retorna

            novoRegistro.id = Date.now(); // Adiciona timestamp como ID
            novoRegistro.editado = false; // Marca como n√£o editado

            // Cria array para a data se n√£o existir
            if (!registros[data]) {
                registros[data] = [];
            }
            registros[data].push(novoRegistro); // Adiciona novo registro

            salvarEAtualizarTudo(); // Salva e atualiza a interface
            alert('Registro salvo com sucesso!'); // Feedback ao usu√°rio
            resetForm(); // Limpa o formul√°rio
        }

        // Exclui um registro espec√≠fico
        function excluirRegistro(date, id) {
            if (confirm('Tem certeza que deseja excluir este registro?')) {
                const recordsDoDia = registros[date];
                const indexParaExcluir = recordsDoDia.findIndex(rec => rec.id == id);

                // Remove o registro se encontrado
                if (indexParaExcluir > -1) {
                    recordsDoDia.splice(indexParaExcluir, 1);
                }
                
                // Remove a data se n√£o houver mais registros
                if (registros[date].length === 0) {
                    delete registros[date];
                }
                
                salvarEAtualizarTudo(); // Salva e atualiza a interface
            }
        }

        // Salva as edi√ß√µes feitas em um registro existente
        function salvarEdicao(date, id) {
            // Obt√©m os novos valores do formul√°rio de edi√ß√£o
            const novosValores = calcularValoresDesdeFormulario('card', id);
            if (!novosValores) return; // Se valida√ß√£o falhou, retorna

            // Encontra o registro original
            const registroParaAtualizar = registros[date].find(rec => rec.id == id);
            
            if (registroParaAtualizar) {
                // Mescla os novos valores com o registro existente
                Object.assign(registroParaAtualizar, novosValores);
                registroParaAtualizar.editado = true; // Marca como editado
                salvarEAtualizarTudo(); // Salva e atualiza a interface
            }
            
            desativarModoEdicao(id); // Sai do modo de edi√ß√£o
        }

        // Ativa o modo de edi√ß√£o para um registro
        function ativarModoEdicao(id, date, forceFaturamentoKm = false) {
            const card = document.querySelector(`.card[data-id="${id}"]`);
            if (!card) return;

            // Encontra o registro
            const record = registros[date].find(r => r.id == id);
            if (!record) return;

            // Mostra formul√°rio de edi√ß√£o e esconde visualiza√ß√£o normal
            card.querySelector('.display-view').classList.add('hidden');
            card.querySelector('.edit-view').classList.remove('hidden');
            card.querySelector('.options-menu').classList.add('hidden'); // Esconde menu de op√ß√µes

            // Preenche os campos do formul√°rio com os valores atuais
            card.querySelector(`#${id}-valorLitro`).value = record.vl;
            card.querySelector(`#${id}-valorAbastecimento`).value = record.va;

            // Campos de faturamento e KM
            const faturamentoInput = card.querySelector(`#${id}-faturamento`);
            const kmInput = card.querySelector(`#${id}-kmRodado`);

            // Preenche faturamento se existir ou se for for√ßado
            if (record.fat !== null && !isNaN(parseFloat(record.fat))) {
                faturamentoInput.value = record.fat;
            } else if (forceFaturamentoKm) {
                faturamentoInput.value = '';
            } else {
                faturamentoInput.value = '';
            }

            // Preenche KM se existir ou se for for√ßado
            if (record.km !== null && !isNaN(parseFloat(record.km))) {
                kmInput.value = record.km;
            } else if (forceFaturamentoKm) {
                kmInput.value = '';
            } else {
                kmInput.value = '';
            }
        }

        // Desativa o modo de edi√ß√£o
        function desativarModoEdicao(id) {
            const card = document.querySelector(`.card[data-id="${id}"]`);
            if (card) {
                // Mostra visualiza√ß√£o normal e esconde formul√°rio de edi√ß√£o
                card.querySelector('.display-view').classList.remove('hidden');
                card.querySelector('.edit-view').classList.add('hidden');
                // Remove marca√ß√£o de campos inv√°lidos
                card.querySelectorAll('input').forEach(input => input.classList.remove('invalid'));
            }
        }

        // Alterna a visibilidade dos campos de faturamento e KM
        function toggleFaturamentoKmFields() {
            const faturamentoKmGroup = document.getElementById('faturamentoKmGroup');
            const toggleFaturamentoKm = document.getElementById('toggleFaturamentoKm');
            
            if (toggleFaturamentoKm.checked) {
                faturamentoKmGroup.classList.add('show'); // Mostra campos
                localStorage.setItem('faturamentoKmActive', 'true'); // Salva prefer√™ncia
            } else {
                faturamentoKmGroup.classList.remove('show'); // Esconde campos
                localStorage.setItem('faturamentoKmActive', 'false'); // Salva prefer√™ncia
                // Limpa e remove valida√ß√£o dos campos
                ['faturamento', 'kmRodado'].forEach(id => {
                    document.getElementById(id).value = '';
                    document.getElementById(id).classList.remove('invalid');
                });
            }
        }

        // Reseta o formul√°rio principal
        function resetForm() {
            // Limpa todos os campos
            ['valorLitro', 'valorAbastecimento', 'faturamento', 'kmRodado'].forEach((id) => {
                document.getElementById(id).value = '';
                document.getElementById(id).classList.remove('invalid');
            });
            
            setDefaultDate(); // Define data padr√£o
            document.getElementById('toggleFaturamentoKm').checked = false; // Desmarca toggle
            toggleFaturamentoKmFields(); // Aplica estado do toggle
            
            // Reseta seletor de combust√≠vel para etanol
            fuelType = 'etanol';
            const fuelSlider = document.getElementById('fuelSlider');
            fuelSlider.className = 'fuel-slider etanol';
            document.querySelectorAll('.fuel-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.value === 'etanol') {
                    opt.classList.add('active');
                }
            });
        }

        // Valida o formul√°rio principal
        function validarFormularioPrincipal() {
            let ok = true;
            const camposBase = ['data', 'valorLitro', 'valorAbastecimento'];
            const camposOpcionais = ['faturamento', 'kmRodado'];

            // Valida campos obrigat√≥rios
            camposBase.forEach(id => {
                const el = document.getElementById(id);
                if (!el.value || parseFloat(el.value) <= 0 || isNaN(parseFloat(el.value))) { 
                    ok = false; 
                    el.classList.add('invalid'); 
                } else { 
                    el.classList.remove('invalid'); 
                }
            });
            
            // Valida campos opcionais se toggle estiver ativo
            if (document.getElementById('toggleFaturamentoKm').checked) {
                camposOpcionais.forEach(id => {
                    const el = document.getElementById(id);
                    if (!el.value || parseFloat(el.value) < 0 || isNaN(parseFloat(el.value))) { 
                        ok = false; 
                        el.classList.add('invalid'); 
                    } else { 
                        el.classList.remove('invalid'); 
                    }
                });
            }
            
            return ok;
        }

        // Valida o formul√°rio de edi√ß√£o no card
        function validarFormularioCard(idPrefix) {
            let ok = true;
            const vlEl = document.getElementById(`${idPrefix}valorLitro`);
            const vaEl = document.getElementById(`${idPrefix}valorAbastecimento`);
            const fatEl = document.getElementById(`${idPrefix}faturamento`);
            const kmEl = document.getElementById(`${idPrefix}kmRodado`);

            // Valida campos obrigat√≥rios
            if (!vlEl.value || parseFloat(vlEl.value) <= 0 || isNaN(parseFloat(vlEl.value))) { 
                ok = false; 
                vlEl.classList.add('invalid'); 
            } else { 
                vlEl.classList.remove('invalid'); 
            }
            
            if (!vaEl.value || parseFloat(vaEl.value) <= 0 || isNaN(parseFloat(vaEl.value))) { 
                ok = false; 
                vaEl.classList.add('invalid'); 
            } else { 
                vaEl.classList.remove('invalid'); 
            }

            // Valida campos opcionais (podem estar vazios)
            if (fatEl.value.trim() !== '' && (parseFloat(fatEl.value) < 0 || isNaN(parseFloat(fatEl.value)))) { 
                ok = false; 
                fatEl.classList.add('invalid'); 
            } else { 
                fatEl.classList.remove('invalid'); 
            }
            
            if (kmEl.value.trim() !== '' && (parseFloat(kmEl.value) < 0 || isNaN(parseFloat(kmEl.value)))) { 
                ok = false; 
                kmEl.classList.add('invalid'); 
            } else { 
                kmEl.classList.remove('invalid'); 
            }

            if (!ok) alert("Por favor, preencha todos os campos obrigat√≥rios corretamente.");
            return ok;
        }

        // Calcula valores com base nos inputs do formul√°rio
        function calcularValoresDesdeFormulario(type, id = '') {
            const prefix = type === 'main' ? '' : `${id}-`; // Prefixo para IDs

            let vl, va, fat, km;

            if (type === 'main') {
                // Para formul√°rio principal
                if (!validarFormularioPrincipal()) return null; // Valida antes
                vl = parseFloat(document.getElementById(`${prefix}valorLitro`).value);
                va = parseFloat(document.getElementById(`${prefix}valorAbastecimento`).value);
                fat = document.getElementById('toggleFaturamentoKm').checked ? 
                    parseFloat(document.getElementById(`${prefix}faturamento`).value) : null;
                km = document.getElementById('toggleFaturamentoKm').checked ? 
                    parseFloat(document.getElementById(`${prefix}kmRodado`).value) : null;
            } else { 
                // Para formul√°rio de edi√ß√£o no card
                if (!validarFormularioCard(prefix)) return null; // Valida antes
                vl = parseFloat(document.getElementById(`${prefix}valorLitro`).value);
                va = parseFloat(document.getElementById(`${prefix}valorAbastecimento`).value);
                fat = document.getElementById(`${prefix}faturamento`).value.trim() !== '' ? 
                    parseFloat(document.getElementById(`${prefix}faturamento`).value) : null;
                km = document.getElementById(`${prefix}kmRodado`).value.trim() !== '' ? 
                    parseFloat(document.getElementById(`${prefix}kmRodado`).value) : null;
            }

            // Realiza os c√°lculos
            const litros = va / vl;
            const lucro = (fat !== null && !isNaN(fat)) ? (fat - va) : null;
            const vkm = (fat !== null && !isNaN(fat) && km !== null && !isNaN(km) && km > 0) ? (fat / km) : null;
            const fpl = (fat !== null && !isNaN(fat) && litros > 0) ? (fat / litros) : null;
            
            // Cria objeto com os valores calculados
            const newValues = {
                vl: vl,
                va: va,
                fat: fat,
                km: km,
                litros: litros,
                lucro: lucro,
                vkm: vkm,
                fpl: fpl,
            };

            // Adiciona tipo de combust√≠vel apenas para novos registros
            if (type === 'main') {
                newValues.fuelType = fuelType;
            }

            return newValues;
        }

        // Salva os registros e atualiza a interface
        function salvarEAtualizarTudo() {
            localStorage.setItem('registros', JSON.stringify(registros)); // Salva no localStorage
            renderizarResultados(); // Atualiza a lista de registros
            atualizarGrafico(); // Atualiza o gr√°fico
            atualizarRelatorio(); // Atualiza o sum√°rio
        }

        // Renderiza os resultados na tela
        function renderizarResultados() {
            const out = document.getElementById('resultados');
            out.innerHTML = '';
            
            // Ordena datas do mais recente para o mais antigo
            const sortedDates = Object.keys(registros).sort((a, b) => new Date(b) - new Date(a));

            // Mensagem se n√£o houver registros
            if (sortedDates.length === 0) {
                out.innerHTML = '<p style="text-align: center; margin-top: 30px; opacity: 0.7;">Nenhum registro encontrado. Comece adicionando um novo!</p>';
                return;
            }

            // Para cada data, cria um grupo
            sortedDates.forEach(d => {
                const header = `<div class="data-header">${formatarData(d)}</div>`;
                const groupContainer = document.createElement('div');
                groupContainer.className = 'date-group';
                groupContainer.innerHTML = header;

                // Para cada registro na data, cria um card
                registros[d].forEach(r => {
                    // Garante que os valores sejam num√©ricos
                    const fat = parseFloat(r.fat);
                    const km = parseFloat(r.km);
                    const va = parseFloat(r.va);
                    const litros = parseFloat(r.litros);
                    const vl = parseFloat(r.vl);
                    const vkm = parseFloat(r.vkm);
                    const fpl = parseFloat(r.fpl);
                    const lucro = parseFloat(r.lucro);

                    const hasFaturamento = !isNaN(fat); // Verifica se tem faturamento
                    
                    // HTML do card
                    const cardHTML = `
                        <div class="card" data-date="${d}" data-id="${r.id}">
                            <!-- Menu de op√ß√µes -->
                            <div class="card-options">
                                <button class="options-btn" data-id="${r.id}">‚ãÆ</button>
                                <div class="options-menu hidden">
                                    <a class="edit-item">‚úèÔ∏è Editar</a>
                                    <a class="delete-item">‚ùå Excluir</a>
                                </div>
                            </div>
                            
                            <div class="result">
                                <!-- Visualiza√ß√£o normal -->
                                <div class="display-view">
                                    <div class="bloco">
                                        ${hasFaturamento ? `
                                        <span class="label faturamento">üí∞ Faturamento: R$ ${fat.toFixed(2).replace('.', ',')}</span>
                                        <span class="label">üõ£Ô∏è KM Rodado: ${km.toFixed(1).replace('.', ',')} km</span>
                                        ` : ''}
                                    </div>
                                    <hr>
                                    <div class="bloco">
                                        <span class="label">‚õΩ Abastecimento: R$ ${va.toFixed(2).replace('.', ',')}</span>
                                        <span class="label">‚õΩ Tipo: ${r.fuelType === 'gasolina' ? 'Gasolina' : 'Etanol'}</span>
                                        <span class="label">üíß Litros: ${litros.toFixed(2).replace('.', ',')} L</span>
                                        <span class="label">üõ¢Ô∏è Valor litro: R$ ${vl.toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    
                                    ${hasFaturamento ? `
                                    <hr>
                                    <div class="bloco">
                                        <span class="label"><strong>M√âDIAS:</strong></span>
                                        <span class="label">üöó R$/KM: R$ ${vkm.toFixed(2).replace('.', ',')}</span>
                                        <span class="label">üìä R$/Litro: R$ ${fpl.toFixed(2).replace('.', ',')}</span>
                                    </div>
                                    ` : ''}
                                    ${r.editado ? '<span class="edited" style="display: block; text-align: right; margin-top: 10px; font-size: 0.8em; opacity: 0.7;">(editado)</span>' : ''}
                                </div>
                                
                                <!-- Formul√°rio de edi√ß√£o (inicialmente oculto) -->
                                <div class="edit-view hidden">
                                    <label for="${r.id}-valorLitro">Valor Litro (R$)</label>
                                    <input type="number" step="0.01" id="${r.id}-valorLitro" value="${r.vl}">
                                    
                                    <label for="${r.id}-valorAbastecimento">Valor Abastecido (R$)</label>
                                    <input type="number" step="0.01" id="${r.id}-valorAbastecimento" value="${r.va}">
                                    
                                    <label for="${r.id}-faturamento">Faturamento (R$)</label>
                                    <input type="number" step="0.01" id="${r.id}-faturamento" value="${hasFaturamento ? fat : ''}" placeholder="Opcional">
                                    
                                    <label for="${r.id}-kmRodado">KM Rodado</label>
                                    <input type="number" step="0.1" id="${r.id}-kmRodado" value="${hasFaturamento ? km : ''}" placeholder="Opcional">
                                    
                                    <!-- Bot√µes de a√ß√£o -->
                                    <div class="edit-actions">
                                        <button class="save-btn-card">Salvar</button>
                                        <button class="cancel-btn-card">Cancelar</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mostra lucro ou bot√£o para adicionar faturamento -->
                            ${!isNaN(lucro) ? `<div class="lucro-borda">Lucro: R$ ${lucro.toFixed(2).replace('.', ',')}</div>` :
                                    `<button class="btn-primary add-faturamento-btn" style="margin-top: 15px; width: auto; display: block; margin-left: auto; margin-right: auto;">Adicionar Faturamento+KM</button>`
                                }
                        </div>`;
                    
                    groupContainer.innerHTML += cardHTML;
                });
                out.appendChild(groupContainer);
            });
        }

        // Cria o gr√°fico usando Chart.js
        function criarGrafico() {
            const ctx = document.getElementById('grafico').getContext('2d');
            if (chart) chart.destroy(); // Destr√≥i gr√°fico existente
            
            // Configura novo gr√°fico
            chart = new Chart(ctx, {
                type: 'bar', // Tipo de gr√°fico (barras)
                data: {
                    labels: [], // Datas (ser√£o preenchidas)
                    datasets: [
                        { 
                            label: 'Lucro', 
                            backgroundColor: 'var(--success)', // Cor verde
                            data: [] // Valores (ser√£o preenchidos)
                        },
                        { 
                            label: 'Faturamento', 
                            backgroundColor: 'var(--primary)', // Cor azul
                            data: [] // Valores (ser√£o preenchidos)
                        },
                    ]
                },
                options: { 
                    responsive: true, // Gr√°fico responsivo
                    scales: { 
                        y: { 
                            beginAtZero: true // Eixo Y come√ßa em zero
                        } 
                    } 
                },
            });
            
            atualizarGrafico(); // Atualiza dados do gr√°fico
        }

        // Atualiza os dados do gr√°fico
        function atualizarGrafico() {
            if (!chart) return;
            
            // Agrupa dados por data
            const datasAgrupadas = {};
            Object.keys(registros).sort((a, b) => new Date(a) - new Date(b)).forEach(d => {
                datasAgrupadas[d] = {
                    lucro: 0,
                    faturamento: 0
                };
                
                // Soma valores para cada data
                registros[d].forEach(r => {
                    datasAgrupadas[d].lucro += parseFloat(r.lucro || 0);
                    datasAgrupadas[d].faturamento += parseFloat(r.fat || 0);
                });
            });

            const datas = Object.keys(datasAgrupadas);
            
            // Atualiza dados do gr√°fico
            chart.data.labels = datas.map(d => d.substring(5).replace('-', '/')); // Formata datas (MM/DD)
            chart.data.datasets[0].data = datas.map(d => datasAgrupadas[d].lucro);
            chart.data.datasets[1].data = datas.map(d => datasAgrupadas[d].faturamento);
            chart.update(); // Atualiza o gr√°fico
        }

        // Atualiza o relat√≥rio/sum√°rio
        function atualizarRelatorio() {
            // Vari√°veis para c√°lculos totais
            let totalLucro = 0, totalFaturamento = 0, totalGastos = 0, totalKm = 0;
            let totalLitrosGasolina = 0, totalKmGasolina = 0;
            let totalLitrosEtanol = 0, totalKmEtanol = 0;

            // Percorre todos os registros para calcular totais
            Object.values(registros).forEach(arrayDeRegistros => {
                arrayDeRegistros.forEach(r => {
                    totalLucro += parseFloat(r.lucro || 0);
                    totalFaturamento += parseFloat(r.fat || 0);
                    totalGastos += parseFloat(r.va || 0);
                    totalKm += parseFloat(r.km || 0);
                    
                    // Separa por tipo de combust√≠vel para c√°lculo de m√©dias
                    if (r.fuelType === 'gasolina') {
                        totalLitrosGasolina += parseFloat(r.litros || 0);
                        totalKmGasolina += parseFloat(r.km || 0);
                    } else {
                        totalLitrosEtanol += parseFloat(r.litros || 0);
                        totalKmEtanol += parseFloat(r.km || 0);
                    }
                });
            });

            // Atualiza valores no sum√°rio
            document.getElementById('totalFaturamento').textContent = `R$ ${totalFaturamento.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalGastosCombustivel').textContent = `R$ ${totalGastos.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalLucro').textContent = `R$ ${totalLucro.toFixed(2).replace('.', ',')}`;
            
            // Calcula m√©dias de km/litro
            const mediaKmLitroGasolina = totalLitrosGasolina > 0 ? 
                (totalKmGasolina / totalLitrosGasolina).toFixed(2).replace('.', ',') : '0,00';
            const mediaKmLitroEtanol = totalLitrosEtanol > 0 ? 
                (totalKmEtanol / totalLitrosEtanol).toFixed(2).replace('.', ',') : '0,00';

            document.getElementById('mediaKmLitroGasolina').textContent = `${mediaKmLitroGasolina} km/L`;
            document.getElementById('mediaKmLitroEtanol').textContent = `${mediaKmLitroEtanol} km/L`;

            // Calcula percentual de lucro bruto
            const percentualLucroBruto = totalFaturamento > 0 ? 
                ((totalFaturamento - totalGastos) / totalFaturamento) * 100 : 0;
            const percentualDisplay = Math.min(percentualLucroBruto, 100); // Limita a 100%
            
            // Atualiza barra de progresso
            const lucroProgressBar = document.getElementById('lucroProgressBar');
            lucroProgressBar.style.width = `${percentualDisplay}%`;
            document.getElementById('lucroProgressText').textContent = `${percentualLucroBruto.toFixed(1)}%`;
            lucroProgressBar.classList.toggle('over-100', percentualLucroBruto >= 100); // Muda cor se >= 100%
        }

        // Reseta todos os dados da aplica√ß√£o
        function resetarDados() {
            if (confirm('Tem certeza que deseja apagar TODOS os registros? Esta a√ß√£o n√£o pode ser desfeita.')) {
                localStorage.clear(); // Limpa localStorage
                registros = {}; // Limpa vari√°vel
                salvarEAtualizarTudo(); // Atualiza interface
                resetForm(); // Reseta formul√°rio
                alert('Todos os dados foram resetados com sucesso!'); // Feedback
            }
        }

        // Inicializa a aplica√ß√£o quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>